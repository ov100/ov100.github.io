<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>消息中间件 | my-doc</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.acb31268.css" as="style"><link rel="preload" href="/assets/js/app.798e7f79.js" as="script"><link rel="preload" href="/assets/js/2.6edc59a2.js" as="script"><link rel="preload" href="/assets/js/15.ae277f92.js" as="script"><link rel="prefetch" href="/assets/js/10.f86d1b43.js"><link rel="prefetch" href="/assets/js/11.72016366.js"><link rel="prefetch" href="/assets/js/12.b0136edf.js"><link rel="prefetch" href="/assets/js/13.4f546296.js"><link rel="prefetch" href="/assets/js/14.58970976.js"><link rel="prefetch" href="/assets/js/3.57203e94.js"><link rel="prefetch" href="/assets/js/4.00c04b5f.js"><link rel="prefetch" href="/assets/js/5.14597a40.js"><link rel="prefetch" href="/assets/js/6.b2615aea.js"><link rel="prefetch" href="/assets/js/7.d50f6c14.js"><link rel="prefetch" href="/assets/js/8.a12fbd4a.js"><link rel="prefetch" href="/assets/js/9.374ef496.js">
    <link rel="stylesheet" href="/assets/css/0.styles.acb31268.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">my-doc</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  java
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  java
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/java/java-started.html" class="sidebar-link">java</a></li><li><a href="/java/base/thread.html" class="sidebar-link">线程</a></li><li><a href="/java/base/thread-pool.html" class="sidebar-link">线程池</a></li><li><a href="/java/base/synchronized.html" class="sidebar-link">synchronized</a></li><li><a href="/java/base/volatile.html" class="sidebar-link">volatile</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>常用框架</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/java/framework/spring-started.html" class="sidebar-link">Spring</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>并发</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/java/concurrent/concurrent-started.html" class="sidebar-link">一级</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>消息中间件</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/java/mq/mq-started.html" aria-current="page" class="active sidebar-link">消息中间件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java/mq/mq-started.html#什么是消息中间件" class="sidebar-link">什么是消息中间件</a></li><li class="sidebar-sub-header"><a href="/java/mq/mq-started.html#为什么要用消息中间件" class="sidebar-link">为什么要用消息中间件？</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="消息中间件"><a href="#消息中间件" class="header-anchor">#</a> 消息中间件</h1> <h2 id="什么是消息中间件"><a href="#什么是消息中间件" class="header-anchor">#</a> 什么是消息中间件</h2> <p>其实并没有标准定义。一般认为，消息中间件属于分布式系统中一个子系统，关注于数据的发送和接收，利用高效可靠的异步消息传递机制对分布
式系统中的其余各个子系统进行集成。
高效:对于消息的处理处理速度快。 可靠:一般消息中间件都会有消息持久化机制和其他的机制确保消息不丢失。 异步:指发送完一个请求，不需要等待返回，随时可以再发送下一个请求，既不需要等待。 一句话总结，我们消息中间件不生产消息，只是消息的搬运工。</p> <h2 id="为什么要用消息中间件"><a href="#为什么要用消息中间件" class="header-anchor">#</a> 为什么要用消息中间件？</h2> <h3 id="应用解耦"><a href="#应用解耦" class="header-anchor">#</a> 应用解耦</h3> <p>系统的耦合性越高，容错性就越低。以电商应用为例，用户创建订单后，如果耦合调用库存系统、物流系统、支付系统，任何一个子系统出了故障或者 因为升级等原因暂时不可用，都会造成下单操作异常，影响用户使用体验
使用消息中间件，系统的耦合性就会提高了。比如物流系统发生故障，需要几分钟才能来修复，在这段时间内，物流系统要处理的数据被缓存到消息队 列中，用户的下单操作正常完成。当物流系统恢复后，继续处理存放在消息队列中的订单消息即可，终端系统感知不到物流系统发生过几分钟故障。</p> <blockquote><p>未解耦架构图</p></blockquote> <div class="language-mermaid extra-class"><pre class="language-text"><code>flowchart LR;  
　　A[订单系统]--&gt;支付系统;
　　A--&gt;物流系统;
　　A--&gt;库存系统; 
</code></pre></div><blockquote><p>解耦后架构图</p></blockquote> <div class="language-mermaid extra-class"><pre class="language-text"><code>flowchart LR;
　　A[订单系统]--&gt;B[MQ];
　　B--&gt;支付系统;
　　B--&gt;物流系统;
　　B--&gt;库存系统; 
</code></pre></div><h3 id="流量削峰"><a href="#流量削峰" class="header-anchor">#</a> 流量削峰</h3> <p>应用系统如果遇到系统请求流量的瞬间猛增，有可能会将系统压垮。有了消息队列可以将大量请求缓存起来，分散到很长一段时间处理，这样可以大大 提到系统的稳定性和用户体验。
互联网公司的大促场景(双十一、店庆活动、秒杀活动)都会使用到 MQ。</p> <blockquote><p>削峰前架构图</p></blockquote> <div class="language-mermaid extra-class"><pre class="language-text"><code>flowchart LR;  
　　A[用户]--&gt;|每秒1k请求|B[A系统]--&gt;|最大每秒200请求|C[(mysql)];
</code></pre></div><blockquote><p>削峰后架构图</p></blockquote> <div class="language-mermaid extra-class"><pre class="language-text"><code>flowchart LR;  
   A[用户]--&gt;|每秒1k请求|B[MQ];
   B--&gt;|每秒拉取200个请求|C[A系统];
   C--&gt;|最大每秒200请求|D[(mysql)];
</code></pre></div><h3 id="数据分发"><a href="#数据分发" class="header-anchor">#</a> 数据分发</h3> <p>通过消息队列可以让数据在多个系统更加之间进行流通。数据的产生方不需要关心谁来使用数据，只需要将数据发送到消息队列，数据使用方直接在消 息队列中直接获取数据即可。<br>
接口调用的弊端，无论是新增系统，还是移除系统，代码改造工作量都很大。<br> <strong>使用 MQ 做数据分发好处，无论是新增系统，还是移除系统，代码改造工作量较小。<br></strong> <strong>所以使用 MQ 做数据的分发，可以提高团队开发的效率。</strong></p> <blockquote><p>使用前架构图</p></blockquote> <div class="language-mermaid extra-class"><pre class="language-text"><code>flowchart LR;  
　　A[A系统]--&gt;|调用接口|B系统;
　　A--&gt;|调用接口|C系统;
　　A--x|移除调用|D系统; 
　　A--&gt;|新增调用接口|E系统; 
</code></pre></div><blockquote><p>使用后架构图</p></blockquote> <div class="language-mermaid extra-class"><pre class="language-text"><code>flowchart LR;  
    A[A系统]--&gt;|生产消息,推送至MQ|B[MQ];
    B&lt;--&gt;|订阅消费消息|B系统;
    B&lt;--&gt;|订阅消费消息|C系统;
    B&lt;--x|取消订阅消费消息|D系统;
    B&lt;--&gt;|新增订阅消费消息|E系统;
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/java/concurrent/concurrent-started.html" class="prev">
        一级
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.798e7f79.js" defer></script><script src="/assets/js/2.6edc59a2.js" defer></script><script src="/assets/js/15.ae277f92.js" defer></script>
  </body>
</html>
